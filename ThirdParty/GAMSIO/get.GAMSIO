#!/bin/bash
#
# This script downloads the GAMS I/O libraries from the GAMS server.
# It takes as argument one or several build types in lowercase for which libaries should be downloaded.
# E.g., ./get.GAMSIO lx3 lei
# If no parameters are given, the script tries to guess the build type according to the output of uname. 

function download() {

echo ""

# haven't found another way to translate from lowercase into uppercase and vice versa  
sys=`echo $1 | sed -e y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/`
sysdir=`echo ${sys} | sed -e y/abcdefghijklmnopqrstuvwxyz/ABCDEFGHIJKLMNOPQRSTUVWXYZ/`

mkdir -p ${sysdir}
cd ${sysdir}
rm -f ${sys}_latest.tgz

echo "Downloading the ${sys} libraries into directory ${sysdir} from www.gams.com..."
$wgetcmd http://www.gams.com/~svigerske/${sys}_latest.tgz

echo "Unpacking the libraries..."
gunzip ${sys}_latest.tgz
tar xf ${sys}_latest.tar

echo "Deleting the tar file..."
rm -f ${sys}_latest.tar

cd ..

}

echo " "
echo "Running script for downloading the GAMS I/O libraries"

wgetcmd=wget
wgetcount=`which wget 2>/dev/null | wc -w`
if test ! $wgetcount = 1; then
  echo "Utility wget not found in your PATH."
  if test `uname` = Darwin; then
    wgetcmd=ftp
    echo "Using ftp command instead."
  else
    exit -1
  fi
fi

#if parameters are given, then call download for each parameter
#otherwise try to guess build system and start appropriate downloads
 
if test $# != 0 ; then
  for i in "$@"; do
    download $i
  done
else
uname=`uname -sp`
case "$uname" in
  Linux*i?86*)
    echo "This seem to be a Linux 32bit machine, downloading lnx, lx3, leg, and lei builds."
    download lnx
    download lx3
    download leg
    download lei
    ;;
  Linux*x86_64*)
    echo "This seem to be a Linux 64bit machine, downloading leg, lei, lnx, and lx3 builds."
    download leg
    download lei
    download lnx
    download lx3
    ;;
  Darwin*i?86*)
    echo "This seem to be a Darwin machine, downloading dii build."
    download dii
    ;;
  SunOS*i?86*)
    echo "This seem to be a Solaris machine, downloading sig build."
    download sig
    ;;
  MINGW32* | CYGWIN*)
    echo "This seem to be a Windows 32 bit machine, downloading vis build."
    download vis
    ;;
  MINGW64*)
    echo "This seem to be a Windows 64 bit machine, downloading wei build."
    download wei
    ;;
  *)
    echo "Cannot determine build type, downloading all builds. uname -sp output: $uname"
    download dii
    download lnx
    download leg
    download lei
    download lx3
    download sig
    download vis
    donwload wei
    ;;
esac
fi

echo " "
echo "Done downloading the GAMS I/O libraries."
echo " "
