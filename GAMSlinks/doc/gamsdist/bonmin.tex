\chapter{\BONMIN and \BONMINH}

%\minitoc

COIN-OR \BONMIN (\textbf{B}asic \textbf{O}pen-source \textbf{N}onlinear \textbf{M}ixed \textbf{In}teger programming) is an open-source solver for mixed-integer nonlinear programming (MINLPs).
The code has been developed as part of a collaboration between Carnegie Mellon University and IBM Research.
The COIN-OR project leader for \BONMIN is Pierre Bonami.

\BONMIN can handle mixed-integer nonlinear programming models which functions should be twice continuously differentiable.
The \BONMIN link in \GAMS supports continuous, binary, and integer variables, special ordered sets, branching priorities, but no semi-continuous or semi-integer variables (see chapter 17.1 of the \GAMS User's Guide).


\BONMIN implements six different algorithms for solving MINLPs:
\begin{itemize}
\setlength{\partopsep}{0pt}
\setlength{\itemsep}{0pt}
\item {B-BB} (\textbf{default}): a simple branch-and-bound algorithm based on solving a continuous nonlinear program at each node of the search tree and branching on integer variables~\cite{GuptaRavindran85}; this algorithm is similar to the one implemented in the solver \textsc{SBB}
\item {B-OA}: an outer-approximation based decomposition algorithm based on iterating solving and improving of a MIP relaxation and solving NLP subproblems~\cite{DuGr86,FlLe94}; this algorithm is similar to the one implemented in the solver \textsc{DICOPT}
\item {B-QG}: an outer-approximation based branch-and-cut algorithm based on solving a continuous linear program at each node of the search tree, improving the linear program by outer approximation, and branching on integer variables~\cite{QeGr92}.
\item {B-Hyb}: a branch-and-bound algorithm which is a hybrid of B-BB and B-QG and is based on solving either a continuous nonlinear or a continuous linear program at each node of the search tree, improving the linear program by outer approximation, and branching on integer variables~\cite{BBCCGLLLMSW}
\item {B-ECP}: a Kelley's outer-approximation based branch-and-cut algorithm inspired by the settings used in the solver \textsc{FilMINT}~\cite{AbLeLi07}
\item {B-iFP}: an iterated feasibility pump algorithm~\cite{BoCoLoMa06}
\end{itemize}
The algorithms are exact when the problem is \textbf{convex}, otherwise they are heuristics.

For convex MINLPs, experiments on a reasonably large test set of problems have shown that B-Hyb is the algorithm of choice (it solved most of the problems in 3 hours of computing time).
Nevertheless, there are cases where B-OA (especially when used with CPLEX as MIP subproblem solver) is much faster than B-Hyb and others where B-BB is interesting.
B-QG and B-ECP corresponds mainly to a specific parameter setting of B-Hyb but they can be faster in some cases.
B-iFP is more tailored at finding quickly good solutions to very hard convex MINLP.
For \textbf{nonconvex} MINLPs, it is strongly recommended to use B-BB (the outer-approximation algorithms have not been tailored to treat nonconvex problems at this point).
Although even B-BB is only a heuristic for such problems, several options are available to try and improve the quality of the solutions it provides (see below).

NLPs are solved in \BONMIN by \IPOPT, which can use \textsc{MUMPS}~\cite{bonminAmestoyDuffKosterLExcellent2001,bonminAmestoyGuermoucheLExcellentPralet2006} (currently the default) or \textsc{MKL PARDISO}~\cite{bonminSchGa04,bonminSchGa06} (only Linux and Windows) as linear solver.
In the commerically licensed \GAMS/\BONMINH version, also the linear solvers \textsc{MA27}, \textsc{MA57}, \textsc{HSL\_MA86}, and \textsc{HSL\_MA97} from the Harwell Subroutines Library (HSL) are available in \IPOPT.
In this case, the default linear solver in \IPOPT is MA27.


For more information we refer to \cite{BoCoLoMa06,BoGo08,BoKiLi09,BBCCGLLLMSW} and the \BONMIN web site \texttt{https://projects.coin-or.org/Bonmin}.
Most of the \BONMIN documentation in this section is taken from the \BONMIN manual~\cite{BonminManual}.


%If \GAMS/\BONMIN is called for a model with only continuous variables, the interface switches over to \IPOPT.
%If \GAMS/\BONMIN is called for a model with only linear equations, the interface switches over to \CBC.

\section{Usage}

The following statement can be used inside your \GAMS program to specify using \BONMIN:
\begin{verbatim}
  Option MINLP = BONMIN;    { or Option MIQCP = BONMIN; }
\end{verbatim}
This statement should appear before the \texttt{Solve} statement.
If \BONMIN was specified as the default solver during \GAMS installation, the above statement is not necessary.

To use \BONMINH, one should use the statement
\begin{verbatim}
  Option MINLP = BONMINH;   { or Option MIQCP = BONMINH; }
\end{verbatim}

\GAMS/\BONMIN currently does not support the \GAMS Branch-and-Cut-and-Heuristic (BCH) Facility.
If you need to use \GAMS/\BONMIN with BCH, please consider to use a \GAMS system of version $\leq 23.3$, available at \url{http://www.gams.com/download/download_old.htm}.
% \GAMS/\BONMIN supports the \GAMS Branch-and-Cut-and-Heuristic (BCH) Facility.
% The \GAMS BCH facility automates all major steps necessary to define, execute, and control the use of user defined routines within the framework of general purpose MIP and MINLP codes.
% Currently supported are user defined cut generators and heuristics, where cut generator cannot be used in Bonmins pure B\&B algorithm (B-BB).
% Please see the BCH documentation at \texttt{http://www.gams.com/docs/bch.htm} for further information.

\subsection{Specification of Options}

A \BONMIN options file contains both \IPOPT and \BONMIN options, for clarity all \BONMIN options should be preceded with the prefix ``\texttt{bonmin.}''. %, except those corresponding to the BCH facility.
The scheme to name option files is the same as for all other \GAMS solvers.
Specifying \texttt{optfile=1} let \GAMS/\BONMIN read \texttt{bonmin.opt}, \texttt{optfile=2} corresponds to \texttt{bonmin.op2}, and so on.
The format of the option file is the same as for \IPOPT (see Section \ref{sub:ipoptoptionspec} in Chapter \ref{cha:ipopt}).

The most important option in \BONMIN is the choice of the solution algorithm.
This can be set by using the option named \texttt{bonmin.algorithm} which can be set to \texttt{B-BB}, \texttt{B-OA}, \texttt{B-QG}, \texttt{B-Hyb}, \texttt{B-ECP}, or \texttt{B-iFP} (its default value is \texttt{B-BB}).
Depending on the value of this option, certain other options may be available or not, cf.\ Section~\ref{sub:bonminalloptions}.

An example of a \texttt{bonmin.opt} file is the following:
\begin{verbatim}
   bonmin.algorithm       B-Hyb
   bonmin.oa_log_level    4
   print_level            6
\end{verbatim}
%    bonmin.milp_subsolver  Cbc_Par
%    milp_sub.cover_cuts    0
%    userheurcall           "bchheur.gms reslim 10"
This sets the algorithm to be used to the hybrid algorithm, the level of outer approximation related output to $4$,
% the MIP subsolver for outer approximation to a parameterized version of CBC, switches off cover cutting planes for the MIP subsolver,
and sets the print level for \IPOPT to $6$.
%  and let \BONMIN call a user defined heuristic specified in the model \texttt{bchheur.gms} with a timelimit of 10 seconds.

\GAMS/\BONMIN understands currently the following \GAMS parameters: \texttt{reslim} (time limit), \texttt{iterlim} (iteration limit), \texttt{nodlim} (node limit), \texttt{cutoff}, \texttt{optca} (absolute gap tolerance), and \texttt{optcr} (relative gap tolerance).
One can set them either on the command line, e.g. \verb+nodlim=1000+, or inside your \GAMS program, e.g. \verb+Option nodlim=1000;+.
Further, the option \texttt{threads} can be used to control the number of threads used in the linear algebra routines of \IPOPT, see Section~\ref{sec:ipoptlinearsolver} in Chapter~\ref{cha:ipopt} for details.

\subsection{Passing options to local search based heuristics and OA generators}
Several parts of the algorithms in \BONMIN are based on solving a simplified version of the problem with another instance of \BONMIN:
Outer Approximation Decomposition (called in {\tt B-Hyb} at the root node)
and Feasibility Pump for MINLP (called in {\tt B-Hyb} or {\tt B-BB} at the root node), RINS, RENS, Local Branching.

In all these cases, one can pass options to the sub-algorithm used through the option file.
The basic principle is that the ``\texttt{bonmin.}'' prefix  is replaced with a prefix that identifies the sub-algorithm used:
\begin{itemize}
\vspace{-2ex}
\setlength{\parskip}{.2ex}
\setlength{\itemsep}{0pt}
\setlength{\partopsep}{0pt}
\item to pass options to Outer Approximation Decomposition: {\tt oa\_decomposition.},
\item to pass options to Feasibility Pump for MINLP: {\tt pump\_for\_minlp.},
\item to pass options to RINS: {\tt rins.},
\item to pass options to RENS: {\tt rens.},
\item to pass options to Local Branching: {\tt local\_branch}.
\end{itemize}

\vspace{-2ex}
For example, to run a maximum of 60 seconds of feasibility pump (FP) for MINLP until 6 solutions are found at the beginning of the hybrid algorithm, one sets the following options:
\begin{verbatim}
bonmin.algorithm              B-Hyb
bonmin.pump_for_minlp         yes   # tells to run FP for MINLP
pump_for_minlp.time_limit     60    # set a time limit for the pump
pump_for_minlp.solution_limit 6     # set a solution limit
\end{verbatim}
Note that the actual solution and time limit will be the minimum of the global limits set for \BONMIN.

A slightly more complicated set of options may be used when using RINS.
Say for example that one wants to run RINS inside \texttt{B-BB}.
Each time RINS is called one wants to solve the small-size MINLP generated using B-QG (one may run any algorithm available in \BONMIN for solving an MINLP) and wants to stop as soon as \texttt{B-QG} found one solution.
To achieve this, one sets the following options
\begin{verbatim}
bonmin.algorithm      B-BB
bonmin.heuristic_rins yes
rins.algorithm        B-QG
rins.solution_limit   1
\end{verbatim}
This example shows that it is possible to set any option used in the sub-algorithm to be different than the one used for the main algorithm.

In the context of outer-approximation (OA) and feasibility pump for MINLP, a standard MILP solver is used.
Several options are available for configuring this MILP solver.
\BONMIN allows a choice of different MILP solvers through the option
\texttt{bonmin.milp\_sol\-ver}. Values for this option are: {\tt Cbc\_D} which uses \CBC with its
default settings, {\tt Cbc\_Par} which uses a version of \CBC that can be parameterized by the user, and \texttt{Cplex} which uses \CPLEX with its default settings.
The options that can be set in {\tt Cbc\_Par} are the number of strong-branching candidates,
the number of branches before pseudo costs are to be trusted, and the frequency of the various cut generators, c.f.\ Section~\ref{sub:bonminalloptions} for details.
To use the \texttt{Cplex} option, a valid \CPLEX licence (standalone or \GAMS/\CPLEX) is required.

\subsection{Getting good solutions to nonconvex problems}
To solve a problem with nonconvex constraints, one should only use the branch-and-bound algorithm {\tt B-BB}.

A few options have been designed in \BONMIN specifically to treat
problems that do not have a convex continuous relaxation.
In such problems, the solutions obtained from \IPOPT are
not necessarily globally optimal, but are only locally optimal.
Also the outer-approximation constraints are not necessarily valid inequalities for the problem.
No specific heuristic method for treating nonconvex problems is implemented
yet within the OA framework.
But for the pure branch-and-bound {\tt B-BB}, a few options have been implemented while having
in mind that lower bounds provided by \IPOPT should not be trusted and with the goal of
trying to get good solutions. Such options are at a very experimental stage.

First, in the context of nonconvex problems, \IPOPT may find different local optima when started
from different starting points. The two options {\tt num\_re\-solve\_at\_root} and {\tt num\_resolve\_at\_node}
allow for solving the root node or each node of the tree, respectively, with a user-specified
number of different randomly-chosen starting points, saving the best solution found.
Note that the function to generate a random starting point is very na\"{\i}ve:
it chooses a random point (uniformly) between the bounds provided for the variable.
In particular if there are some functions that can not be evaluated at some points of the domain, it may pick such points,
and so it is not robust in that respect.

Secondly, since the solution given by \IPOPT does not truly give a lower bound, the fathoming rule can be changed to continue branching even if the solution value to the current node is worse than the best-known solution.
This is achieved by setting {\tt allowable\_gap}
and {\tt allowable\_fraction\_gap} and {\tt cutoff\_decr} to negative values.

\subsection{\IPOPT options changed by \BONMIN}

\IPOPT has a very large number of options, see Section \ref{sub:ipoptoptions} to get a complete description.
To use \IPOPT more efficiently in the context of MINLP,
\BONMIN changes some \IPOPT options from their default values, which may help to improve \IPOPT's warm-starting capabilities and its ability to prove quickly that a subproblem is infeasible.
These are settings that \IPOPT does not use for ordinary NLP problems.
Note that options set by the user in an option file will override these settings.
\begin{itemize}
\vspace{-2ex}
\setlength{\partopsep}{0pt}
\setlength{\itemsep}{0pt}
\setlength{\parskip}{.5ex}
\item {\tt mu\_strategy} and {\tt mu\_oracle} are set, respectively, to
{\tt adaptive} and {\tt probing} by default. These are strategies in \IPOPT
for updating the barrier parameter. They were found to be more efficient in the context of MINLP.

\item {\tt gamma\_phi} and {\tt gamma\_theta} are set to $10^{-8}$ and $10^{-4}$ respectively.
This has the effect of reducing the size of the filter in the line search performed by \IPOPT.

\item {\tt required\_infeasibility\_reduction} is set to $0.1$.
This increases the required infeasibility reduction when \IPOPT enters the
restoration phase and should thus help to detect infeasible problems faster.

\item {\tt expect\_infeasible\_problem} is set to {\tt yes}, which enables some heuristics
to detect infeasible problems faster.

\item {\tt warm\_start\_init\_point} is set to {\tt yes} when a full primal/dual starting
point is available (generally for all the optimizations after the continuous relaxation has been solved).

\item {\tt print\_level} is set to $0$ by default to turn off \IPOPT output (except for the root node, which print level is controlled by the \BONMIN option \texttt{nlp\_log\_at\_root}).

\item \texttt{bound\_relax\_factor} is set to $10^{-10}$. All of the bounds
of the problem are relaxed by this factor. This may cause some trouble
when constraint functions can only be evaluated within their bounds.
In such cases, this option should be set to $0$.
\end{itemize}

\section{Detailed Options Description}
\label{sub:bonminalloptions}

The following tables give the list of options together with their types, default values, and availability in each of the main algorithms.
% The column labeled `type' indicates the type of the parameter.
%  (`F' stands for float, `I' for integer, and `S' for string).
% The column labeled `default' indicates the global default value.
% Then for each of the algorithms \texttt{B-BB}, \texttt{B-OA}, \texttt{B-QG}, \texttt{B-Hyb}, \texttt{B-Ecp}, and \texttt{B-iFP} `$+$' indicates that the option is available for that particular algorithm, while `$-$' indicates that it is not.
The column labeled `\texttt{Cbc\_Par}' indicates the options that can be used to parametrize the MLIP subsolver in the context of OA and FP.

% \newpage
\input{optbonmin_s}

In the following we give a detailed list of \BONMIN options.
The value on the right denotes the default value.
\input{optbonmin_a}

\bibliographystyle{plain}
%\bibliography{coinlibd}
%\renewcommand{\bibname}{BONMIN References}
\input{bonmin.bbl}

\chapterend
